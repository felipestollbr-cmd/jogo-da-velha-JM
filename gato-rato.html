<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gato e Rato Online - JM</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        body {
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; margin: 0; background-color: #2c3e50;
            font-family: 'Segoe UI', sans-serif; color: white; touch-action: manipulation;
        }

        /* √Årea do Tabuleiro (Grid 8x8) */
        #game-container {
            display: grid;
            grid-template-columns: repeat(8, 10vw);
            grid-template-rows: repeat(8, 10vw);
            gap: 2px; background-color: #34495e;
            padding: 5px; border-radius: 10px;
            max-width: 350px; max-height: 350px; margin-top: 10px;
        }

        .tile {
            background-color: #ecf0f1; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem;
        }

        /* Controles Celular */
        .controls {
            display: grid; grid-template-columns: repeat(3, 60px);
            gap: 10px; margin: 20px 0;
        }

        .btn-dir {
            width: 60px; height: 60px; background: #f1c40f; border: none;
            border-radius: 10px; font-size: 1.5rem; font-weight: bold;
            color: #2c3e50; cursor: pointer;
        }

        #btn-up { grid-column: 2; }
        #btn-left { grid-column: 1; }
        #btn-right { grid-column: 3; }
        #btn-down { grid-column: 2; }

        /* Chat e Info */
        #info-box { text-align: center; margin-top: 10px; }
        #chat-area {
            width: 90%; max-width: 350px; background: white;
            border-radius: 8px; color: black; margin-bottom: 20px;
        }
        #messages { height: 80px; overflow-y: auto; padding: 8px; font-size: 0.8rem; }
        .input-group { display: flex; border-top: 1px solid #ddd; }
        .input-group input { flex: 1; padding: 8px; border: none; border-radius: 0 0 0 8px; }
        .input-group button { background: #27ae60; color: white; border: none; padding: 8px; border-radius: 0 0 8px 0; }

        .assinatura { margin-bottom: 10px; font-size: 1.1rem; color: #f1c40f; font-weight: bold; }
    </style>
</head>
<body>

    <div id="info-box">
        <div id="status">Conectando...</div>
        <div id="meu-personagem">Voc√™ √©: ?</div>
    </div>

    <div id="game-container"></div>

    <div class="controls">
        <button class="btn-dir" id="btn-up" onclick="mover('cima')">‚Üë</button>
        <button class="btn-dir" id="btn-left" onclick="mover('esquerda')">‚Üê</button>
        <button class="btn-dir" id="btn-down" onclick="mover('baixo')">‚Üì</button>
        <button class="btn-dir" id="btn-right" onclick="mover('direita')">‚Üí</button>
    </div>

    <div id="chat-area">
        <div id="messages"></div>
        <div class="input-group">
            <input type="text" id="chat-in" placeholder="Oi!">
            <button onclick="enviarMsg()">Enviar</button>
        </div>
    </div>

    <div class="assinatura">by Jo√£o Marcelo</div>

    <script>
        // --- CONFIGURA√á√ÉO FIREBASE ---
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            databaseURL: "https://SEU_PROJETO.firebaseio.com",
            projectId: "SEU_PROJETO",
            appId: "APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref('gato_rato_v1');

        let meuPapel = ""; // "gato" ou "rato"
        let posGato = { x: 0, y: 0 };
        let posRato = { x: 7, y: 7 };
        let meuNome = localStorage.getItem('nomeJM') || prompt("Seu nome:");
        localStorage.setItem('nomeJM', meuNome);

        // Gerar Tabuleiro
        const container = document.getElementById('game-container');
        for(let i=0; i<64; i++) {
            let tile = document.createElement('div');
            tile.classList.add('tile');
            tile.id = `tile-${i}`;
            container.appendChild(tile);
        }

        // Entrar no Jogo
        db.child('jogadores').once('value', snap => {
            if(!snap.child('gato').exists()) {
                meuPapel = "gato";
                db.child('jogadores/gato').set(meuNome);
            } else if(!snap.child('rato').exists()) {
                meuPapel = "rato";
                db.child('jogadores/rato').set(meuNome);
            } else {
                meuPapel = "espectador";
            }
            document.getElementById('meu-personagem').innerText = `Voc√™ √© o: ${meuPapel === 'gato' ? 'üê± Gato' : 'üê≠ Rato'}`;
        });

        // Atualizar Tela
        db.on('value', snap => {
            const data = snap.val();
            if(!data) return;

            posGato = data.posGato || {x:0, y:0};
            posRato = data.posRato || {x:7, y:7};

            // Limpar tabuleiro
            document.querySelectorAll('.tile').forEach(t => t.innerText = "");

            // Desenhar Gato e Rato
            document.getElementById(`tile-${posGato.y * 8 + posGato.x}`).innerText = "üê±";
            document.getElementById(`tile-${posRato.y * 8 + posRato.x}`).innerText = "üê≠";

            // Verificar Colis√£o (Gato pegou Rato)
            if(posGato.x === posRato.x && posGato.y === posRato.y) {
                document.getElementById('status').innerText = "O GATO PEGOU O RATO! üê±üèÜ";
                setTimeout(resetarJogo, 3000);
            } else {
                document.getElementById('status').innerText = "Ca√ßada em curso...";
            }

            // Atualizar Chat
            const msgDiv = document.getElementById('messages');
            msgDiv.innerHTML = "";
            if(data.chat) {
                Object.values(data.chat).forEach(m => {
                    msgDiv.innerHTML += `<div><b>${m.u}:</b> ${m.t}</div>`;
                });
                msgDiv.scrollTop = msgDiv.scrollHeight;
            }
        });

        function mover(dir) {
            if(meuPapel === "espectador") return;

            let p = meuPapel === "gato" ? {...posGato} : {...posRato};

            if(dir === 'cima' && p.y > 0) p.y--;
            if(dir === 'baixo' && p.y < 7) p.y++;
            if(dir === 'esquerda' && p.x > 0) p.x--;
            if(dir === 'direita' && p.x < 7) p.x++;

            if(meuPapel === "gato") db.update({ posGato: p });
            else db.update({ posRato: p });
        }

        function enviarMsg() {
            const val = document.getElementById('chat-in').value;
            if(!val) return;
            db.child('chat').push({ u: meuNome, t: val });
            document.getElementById('chat-in').value = "";
        }

        function resetarJogo() {
            db.update({
                posGato: {x:0, y:0},
                posRato: {x:7, y:7}
            });
        }
    </script>
</body>
</html>
